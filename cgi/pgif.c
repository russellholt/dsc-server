/* * pgif [status file] [output image path] * * Pastes several ppms to a larger ppm, according to the * specifications in the status file, and converts the * output to a gif, specified by the output image path. * Does this by calling the pbmplus utilities through the shells. * * 6/29/95: added the -transparent flag to the ppmtogif call * */#include <stdio.h>void usage(char *name);main(int argc, char **argv){char *mapfile, bigcmdline[512];FILE *fp;char line[80],	name[40],	status[40],	coord[20],	xc[10],	yc[10],	syscl[256],	tempfile[50], infile[50],	plotfile[256], outputfile[256],	sourceimage[40],	imagelist[3][40],	word[3][40],	*image;    /* points to the current image in the imagelist *//*	*pnmpaste = "/mongo/apps/netpbm/bin/pnmpaste",	*ppmtogif = "/mongo/apps/netpbm/bin/ppmtogif",*/int iter=0, x;	if (argc < 2)		usage(argv[0]);	mapfile = argv[1];	printf("Using map file %s\n", mapfile);	fp = fopen(mapfile, "r");	if (fp)	{		/* unique temp file */		sprintf(tempfile, "/tmp/status-temp%d%d.ppm", iter, getpid());		/* Read the name of the output file */		fscanf(fp, "%s", outputfile);		/* Read the name of the background image */		fscanf(fp, "%s", sourceimage);		sprintf(plotfile, "%s", sourceimage);		strcpy(infile, plotfile);   /* plotfile to infile */		printf("Source image file is '%s'\n", sourceimage);		/* Read the image and keyword list */		for(x=0; x<3; x++)			fscanf(fp, "%s %s", imagelist[x], word[x]);		while (!feof(fp))		{			fgets(line, 80, fp);			if (feof(fp))   /* premature end ? */				break;			if (line[0] == '#') /* skip comment */				continue;			if (line[0] == '\n')    /* skip blank line */				continue;			sscanf(line, "%s %s %s", name, status, coord);			sscanf(coord, "(%[^(),], %[^(),]", xc, yc);			/* Find the status image to use according to the			 * keyword for this entry (match entry's keyword			 * against the word list)			 */			for(x=0; x<3; x++)				if (strcmp(status, word[x]) == 0)				{					image = imagelist[x];					break;				}			/* Create a command line */			sprintf(syscl, "pnmpaste %s %s %s %s > %s",				image, xc, yc, infile, tempfile);			printf("%s\n", syscl);			system(syscl);			if (iter)   /* not the first one! */				unlink(infile); /* remove source file */			strcpy(infile, tempfile);   /* copy tempfile to infile */			sprintf(tempfile, "/tmp/status-temp%d%d.ppm", ++iter, getpid());		}		fclose(fp);		/* Create final output file: convert to GIF */		unlink(outputfile);	/* old output file */		sprintf(syscl, "ppmtogif -transparent white %s > %s",			infile, outputfile);		printf("%s\n", syscl);		system(syscl);		unlink(infile); /* remove source file */	}	else	{		fprintf(stderr, "%s: Unable to read mapping file %s\n",			argv[0], mapfile);		exit(1);	}}void usage(char *name){	fprintf(stderr, "Usage: %s [mapping file]\n", name);	exit(1);}