/*  Status 2 *   a cgi program * *   takes the name of a status map file as cgi input data via GET * *  Reads a status map file and puts the data into a form to *  be edited.  This new form gets submitted to Status 3 hey ho! * *    (Status 3 produces a bunch of sed commands to modify the *    status map file, then runs the program pgif on it to create *    the actual status image) * * A lot of this code is held over from the original status mapper * (which was not an editor), but was basically pgif * *  Russell Holt, mid June 1995 */#include <stdio.h>#include <stdlib.h>#include "entry.h"#ifndef debug#define debug 0#endifchar *skipspaces(char *p);/* DoCGIThing: the 'main' routine; called from cgimain.c */void DoCGIThing(entries, m)entry entries[];int m;	/* max */{int x;FILE *fp;char line[80];char name[40];char status[40];char outputfile[80];char coord[40];char xc[40];char yc[40];char *ptr;int l;char syscl[256];char tempfile[50];char infile[50];char *absdir = "/www/htdocs";char *imagedir = "/status/";int big = 0;int iter=0;char sourceimage[40];char imagelist[3][40], word[3][40];char *image;	/* points to the current image in the imagelist */char *datafile, *lights;char *pgif;	lights = datafile = NULL;	sprintf(tempfile, "/tmp/stat-sed%d", getpid());	for(x=0; x<=m; x++)	{			if (strcmp(entries[x].name, "file") == 0)				datafile = entries[x].val;			else				if (strcmp(entries[x].name, "pgif") == 0)					pgif = entries[x].val;	}	printf("<title>Status2</title>");    printf("<center><H1>Status2</H1><HR></center>");	if (m < 0)		fp = fopen("/www/htdocs/status-map.txt", "r");	else		fp = fopen(datafile, "r");	if (fp)	{		/* read the name of the output file */		fscanf(fp, "%s", outputfile);		/* read the background source image filename */		fscanf(fp, "%s", sourceimage);		printf("<center>");		printf("<table border=1 cellpadding=3 cellspacing=1>");		for(x=0; x<3; x++)		{			fscanf(fp, "%s %s", imagelist[x], word[x]);			printf("<tr><td>%s</td><td> %s<br></td></tr>",				imagelist[x], word[x]);		}		printf("</table><p>\n");		printf("<form method=GET action=\"/cgi-bin/status3\">");		if (datafile)			printf("<input type=hidden name=\"file\" value=\"%s\">\n",				datafile);		printf("<input type=hidden name=\"pgif\" value=\"%s\">\n",			pgif);		printf("<table border=2 cellpadding=3>\n");		printf("<tr><td align=center><b>Name</b></td>");		printf("<td align=center><b>Old Status</b></td>");		printf("<td align=center><b>New Status</b></td>");		printf("<td align=center><b>x</b></td>");		printf("<td align=center><b>y</b></td></tr>");		while (!feof(fp))		{			fgets(line, 80, fp);			if (feof(fp))	/* premature end ? */				break;			if (line[0] == '#')	/* skip comment */				continue;			if (line[0] == '\n')	/* skip blank line */				continue;			sscanf(line, "%s %s %s", name, status, coord);			sscanf(coord, "(%[^(),], %[^(),]", xc, yc);			printf("<tr><td> %s </td>", name);			printf("<td align=center> <b>%s</b> </td>", status);			printf("<td><select name=\"%s\">\n", name);			for(x=0; x<3; x++)				printf("<option%s>%s\n", 					(strcmp(word[x], status))? "" : " selected",					word[x]);			printf("</select></td>\n");			/* printf("<td> %s </td>", status); */		/*			printf("<td align=center> %s </td>", xc);			printf("<td align=center> %s <br></td></tr>", yc);		*/			printf("<td align=center>");			printf("<input type=text name=\"x-%s\" value=\"%s\" size=4>",				name, xc);			printf("</td>");						printf("<td align=center>");			printf("<input type=text name=\"y-%s\" value=\"%s\" size=4>",				name, yc);			printf("<br></td></tr>");			for(x=0; x<3; x++)				if (strcmp(status, word[x]) == 0)				{					image = imagelist[x];					break;				}		}		printf("</table>");		fclose(fp);		printf("<p><input type=submit value=\" OK \"<p>");		printf("</center>");	}	else	{		printf("Unable to read status data.\n");	}	printf("<p><HR><a href=\"/metaURL\">metaURL</a>");}